{% assign order_qualifies = true %}

{% if order.email == blank %}
  {% assign order_qualifies = false %}
{% elsif order.financial_status != "pending" %}
  {% assign order_qualifies = false %}
{% endif %}

{% if event.preview or order_qualifies %}
  {
    "action": {
      "type": "email",
      "options": {
        "to": {{ order.email | json }},
        "subject": {{ options.email_subject__required | strip | json }},
        "body": {{ options.email_body__multiline_required | strip | newline_to_br | json }},
        "reply_to": {{ shop.customer_email | json }},
        "from_display_name": {{ shop.name | json }},
        "attachments": {
          {{ options.pdf_attachment_filename__required | json }}: {
            "pdf": {
              "html": {{ options.pdf_html_template__code_multiline_required | json }}
            }
          }
        }
      }
    }
  }
{% endif %}